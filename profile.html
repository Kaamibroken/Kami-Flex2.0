<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kami Flex - Profile</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .avatar-wrapper {
      position: relative;
      display: inline-block;
    }
    .camera-icon {
      position: absolute;
      bottom: 0;
      right: 0;
      cursor: pointer;
      font-size: 18px; /* üì∏ icon size */
      background: none; /* ‚ùå background hataya */
      border-radius: 0;
      padding: 0;
      box-shadow: none;
    }
    .remove-icon {
      position: absolute;
      top: -5px;
      right: -5px;
      color: #ff4d4d;   /* sirf red icon */
      font-size: 16px;
      cursor: pointer;
      background: none; /* ‚ùå background hataya */
      border-radius: 0;
      padding: 0;
      box-shadow: none;
      line-height: 1;
    }
    #avatarInput {
      display: none;
    }
    .copy-icon {
      margin-left: 6px;
      cursor: pointer;
      font-size: 14px;
      color: #555;
    }
    .copy-icon:hover {
      color: #000;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-200 via-purple-200 to-pink-200 font-sans">

  <!-- HEADER -->
  <header class="backdrop-blur-sm bg-white/30 sticky top-0 z-40 flex items-center justify-between px-6 py-4">
    <button onclick="window.location.href='home.html'" class="w-10 h-10 rounded-full bg-white flex items-center justify-center shadow">
      ‚¨Ö
    </button>
    <h1 class="text-xl font-extrabold">Profile</h1>
    <div class="w-10"></div>
  </header>

  <!-- MAIN -->
  <main class="max-w-md mx-auto bg-white/80 p-6 mt-8 rounded-2xl shadow-lg space-y-6">
    
    <!-- Avatar -->
    <div class="flex flex-col items-center">
      <div class="avatar-wrapper">
        <img id="avatarPreview" src="images/default-avatar.png" class="w-24 h-24 rounded-full object-cover shadow">
        <span class="camera-icon" onclick="document.getElementById('avatarInput').click()">üì∏</span>
        <span class="remove-icon hidden" id="removeAvatar" onclick="removeAvatar()">üóëÔ∏è</span>
        <input type="file" id="avatarInput" accept="image/*">
      </div>
      <h2 id="profileName" class="mt-3 text-xl font-bold"></h2>
      <p class="text-sm text-gray-600 flex items-center justify-center">
        <span id="userUID"></span>
        <span class="copy-icon" onclick="copyUID()">üìã</span>
      </p>
    </div>

    <!-- Profile Info Form -->
    <form id="profileForm" class="space-y-4">
      <!-- Username -->
      <div>
        <label class="block text-sm font-medium mb-1">Username</label>
        <input type="text" id="userName" class="w-full px-4 py-2 border rounded-lg">
      </div>

      <div id="emailSection" class="hidden">
        <label class="block text-sm font-medium mb-1">Email</label>
        <input type="email" id="userEmail" class="w-full px-4 py-2 border rounded-lg">
      </div>

      <div id="phoneSection" class="hidden">
        <label class="block text-sm font-medium mb-1">Phone</label>
        <input type="tel" id="userPhone" class="w-full px-4 py-2 border rounded-lg">
      </div>

      <button type="submit" class="w-full py-2 bg-gradient-to-r from-pink-500 to-yellow-400 text-white rounded-full">
        Save Changes
      </button>
    </form>

    <!-- Password Change -->
    <div class="border-t pt-6">
      <h3 class="text-lg font-bold mb-3">Change Password</h3>
      <form id="passwordForm" class="space-y-3">
        <input type="password" id="currentPassword" placeholder="Current Password" class="w-full px-4 py-2 border rounded-lg">
        <input type="password" id="newPassword" placeholder="New Password" class="w-full px-4 py-2 border rounded-lg">
        <input type="password" id="confirmPassword" placeholder="Confirm New Password" class="w-full px-4 py-2 border rounded-lg">
        <button type="submit" class="w-full py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full">
          Update Password
        </button>
      </form>
    </div>
  </main>

  <!-- POPUP -->
  <div id="popup" class="fixed inset-0 flex items-center justify-center bg-black/50 hidden">
    <div class="bg-white p-6 rounded-2xl shadow-2xl w-80 text-center">
      <h3 id="popupTitle" class="text-xl font-bold mb-2">Title</h3>
      <p id="popupMessage" class="text-gray-600 mb-4">Message here...</p>
      <button onclick="closePopup()" class="px-6 py-2 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 text-white">OK</button>
    </div>
  </div>

  <script>
    let currentUser = JSON.parse(localStorage.getItem("currentUser"));
    if (!currentUser) window.location.href = "signin.html";

    if (!currentUser.uid) {
      currentUser.uid = "UID" + Math.floor(Math.random() * 100000);
      localStorage.setItem("currentUser", JSON.stringify(currentUser));
    }

    // Show data
    document.getElementById("profileName").innerText = currentUser.name || "User";
    document.getElementById("userName").value = currentUser.name || "";
    document.getElementById("userUID").innerText = currentUser.uid;

    if (currentUser.email) {
      document.getElementById("emailSection").classList.remove("hidden");
      document.getElementById("userEmail").value = currentUser.email;
    }
    if (currentUser.phone) {
      document.getElementById("phoneSection").classList.remove("hidden");
      document.getElementById("userPhone").value = currentUser.phone;
    }
    if (currentUser.avatar) {
      document.getElementById("avatarPreview").src = currentUser.avatar;
      document.getElementById("removeAvatar").classList.remove("hidden");
    }

    // Avatar upload
    document.getElementById("avatarInput").addEventListener("change", e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = ev => {
          document.getElementById("avatarPreview").src = ev.target.result;
          currentUser.avatar = ev.target.result;
          localStorage.setItem("currentUser", JSON.stringify(currentUser));
          document.getElementById("removeAvatar").classList.remove("hidden");
        };
        reader.readAsDataURL(file);
      }
    });

    function removeAvatar() {
      document.getElementById("avatarPreview").src = "images/default-avatar.png";
      delete currentUser.avatar;
      localStorage.setItem("currentUser", JSON.stringify(currentUser));
      document.getElementById("removeAvatar").classList.add("hidden");
    }

    // Copy UID
    function copyUID() {
      navigator.clipboard.writeText(currentUser.uid).then(() => {
        showPopup("‚úÖ Success", "UID copied to clipboard!");
      });
    }

    // Profile Save
    document.getElementById("profileForm").addEventListener("submit", e => {
      e.preventDefault();
      let updated = false;

      const name = document.getElementById("userName").value.trim();
      const email = document.getElementById("userEmail")?.value.trim();
      const phone = document.getElementById("userPhone")?.value.trim();

      if (name && name !== currentUser.name) { currentUser.name = name; updated = true; }
      if (email && email !== currentUser.email) { currentUser.email = email; updated = true; }
      if (phone && phone !== currentUser.phone) { currentUser.phone = phone; updated = true; }

      if (updated) {
        localStorage.setItem("currentUser", JSON.stringify(currentUser));
        showPopup("‚úÖ Success", "Profile updated successfully!");
        document.getElementById("profileName").innerText = currentUser.name;
      } else {
        showPopup("‚ö†Ô∏è Notice", "No changes made.");
      }
    });

    // Password Change
    document.getElementById("passwordForm").addEventListener("submit", e => {
      e.preventDefault();
      const current = document.getElementById("currentPassword").value.trim();
      const newPass = document.getElementById("newPassword").value.trim();
      const confirm = document.getElementById("confirmPassword").value.trim();

      if (current !== currentUser.password) {
        showPopup("‚ùå Error", "Current password is incorrect!");
        return;
      }
      if (!newPass || newPass !== confirm) {
        showPopup("‚ö†Ô∏è Warning", "New passwords do not match!");
        return;
      }

      currentUser.password = newPass;
      localStorage.setItem("currentUser", JSON.stringify(currentUser));
      showPopup("‚úÖ Success", "Password updated successfully!");
      document.getElementById("passwordForm").reset();
    });

    function showPopup(title, message) {
      document.getElementById("popupTitle").innerText = title;
      document.getElementById("popupMessage").innerText = message;
      document.getElementById("popup").classList.remove("hidden");
    }
    function closePopup() {
      document.getElementById("popup").classList.add("hidden");
    }
  </script>
</body>
</html>


